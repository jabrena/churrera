@startuml
!theme plain
title Churrera Core Module Class Diagram

package "info.jab.churrera.workflow" {
  class WorkflowParser {
    - logger: Logger
    + parse(File): WorkflowData
    + parse(Path): WorkflowData
    + determineWorkflowType(File): WorkflowType
    - parseV2Workflow(Node): WorkflowData
    - parseParallelWorkflow(Element): WorkflowData
    - parseSequenceInfo(Element): SequenceInfo
    - inferTypeFromExtension(String): String
  }
  
  class WorkflowData {
    - launchPrompt: PromptInfo
    - model: String
    - repository: String
    - updatePrompts: List<PromptInfo>
    - parallelData: ParallelWorkflowData
    - timeoutMillis: Long
    - fallbackSrc: String
    + getLaunchPrompt(): PromptInfo
    + getModel(): String
    + getRepository(): String
    + getUpdatePrompts(): List<PromptInfo>
    + getParallelData(): ParallelWorkflowData
    + getTimeoutMillis(): Long
    + getFallbackSrc(): String
    + isParallelWorkflow(): boolean
  }
  
  class WorkflowValidator {
    - logger: Logger
    + validate(File): List<String>
    - validateWorkflowStructure(File): List<String>
    - validatePromptsExist(File): List<String>
  }
  
  class PmlValidator {
    - logger: Logger
    + validate(File): List<String>
    - validatePmlStructure(File): List<String>
  }
  
  class WorkflowType {
    <<enumeration>>
    SEQUENCE
    PARALLEL
  }
  
  class PromptInfo {
    - srcFile: String
    - type: String
    - bindResultExp: String
    + getSrcFile(): String
    + getType(): String
    + getBindResultExp(): String
    + hasBindResultExp(): boolean
  }
  
  class SequenceInfo {
    - model: String
    - repository: String
    - prompts: List<PromptInfo>
    - timeoutMillis: Long
    - fallbackSrc: String
    + getModel(): String
    + getRepository(): String
    + getPrompts(): List<PromptInfo>
    + getTimeoutMillis(): Long
    + getFallbackSrc(): String
  }
  
  class ParallelWorkflowData {
    - parallelPrompt: PromptInfo
    - bindResultType: String
    - sequences: List<SequenceInfo>
    - timeoutMillis: Long
    - fallbackSrc: String
    + getParallelPrompt(): PromptInfo
    + getBindResultType(): String
    + getSequences(): List<SequenceInfo>
    + getTimeoutMillis(): Long
    + getFallbackSrc(): String
  }
  
  class TimeoutParser {
    + parseToMillis(String): Long
  }
  
  class ExpressionEvaluator {
    + replaceInputPlaceholder(String, String): String
  }
  
  class BindResultTypeMapper {
    + mapBindResultType(String): String
  }
  
  class WorkflowParseException {
    + WorkflowParseException(String)
    + WorkflowParseException(String, Throwable)
  }
}

package "info.jab.churrera.util" {
  class PmlConverter {
    + toMarkdownFromContent(String): String
    + toMarkdownFromContent(String, String): String
  }
  
  class PropertyResolver {
    + getProperty(String, String): Optional<String>
  }
  
  class CursorApiKeyResolver {
    + resolveApiKey(): String
  }
  
  class ClasspathResolver {
    + resolvePath(String): String
  }
  
  class ConversationJsonDeserializer {
    + deserialize(String): ConversationResponse
  }
}

' Relationships
WorkflowParser --> WorkflowData : creates
WorkflowParser --> SequenceInfo : creates
WorkflowParser --> ParallelWorkflowData : creates
WorkflowParser --> PromptInfo : creates
WorkflowParser --> WorkflowType : uses

WorkflowData --> PromptInfo
WorkflowData --> ParallelWorkflowData
WorkflowData --> SequenceInfo

ParallelWorkflowData --> PromptInfo
ParallelWorkflowData --> SequenceInfo

SequenceInfo --> PromptInfo

WorkflowValidator --> WorkflowParser
PmlValidator --> WorkflowParser

WorkflowParseException --|> Exception

@enduml
